!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.ecs=e():t.ecs=e()}(this,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(2);e.ComponentFactory=r.ComponentFactory,e.EntityFactory=r.EntityFactory;var i=n(4);e.System=i.System,e.MultiParallelSystem=i.MultiParallelSystem,e.MultiNonParallelSystem=i.MultiNonParallelSystem},function(t,e,n){"use strict";var r=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var i=n(3),o=function(t){function e(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=t.call(this)||this;o._size=e,o._iterationLength=0,o._nbActive=0,o._nbInactive=0,o._nbCreated=0,o._zeroedRef=new(n.bind.apply(n,[void 0,"zeroedCompRef",!1].concat(r))),o._values.length=o._size;for(var s=0;s<e;++s)o.createZeroedComponentAt(s);return o}return r(e,t),e.prototype.createZeroedComponentAt=function(t){this.recycle(t,this._zeroedRef),this._values[t].entityId="0",this._values[t].active=!1},e.prototype.activate=function(t,e){var n=this.get(t);n.active!==e&&(n.active=e,e?(this._nbActive+=1,this._nbInactive-=1):(this._nbActive-=1,this._nbInactive+=1))},e.prototype.activateAll=function(t){for(var e=0;e<this.size;++e)this.values[e].active=t;t?(this._nbActive=this._nbCreated,this._nbInactive=0):(this._nbActive=0,this._nbInactive=this._nbCreated)},e.prototype.clear=function(){t.prototype.clear.call(this),this._nbActive=0,this._nbInactive=0,this._nbCreated=0,this._iterationLength=0},e.prototype.create=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];var i,o;if(this.has(t))i=this._keys.get(t),o=this.values[i],o.active!==e&&(e?(this._nbActive+=1,this._nbInactive-=1):(this._nbActive-=1,this._nbInactive+=1));else{if(-1===(i=this.getIndexOfFirstAvailableSpot()))throw new Error("no free slot available, please resize the pool");this._keys.set(t,i),this._nbCreated+=1,e?this._nbActive+=1:this._nbInactive+=1,o=this.values[i]}return o.entityId=t,o.active=e,this.incrementCreatedLength(i),this.values[i]},e.prototype.getIndexOfFirstAvailableSpot=function(){for(var t=this._values.length,e=0;e<t;++e)if("0"===this._values[e].entityId)return e;return-1},e.prototype.mapObject=function(t,e){for(var n in e)t.hasOwnProperty(n)&&(t[n]=e[n])},e.prototype.decrementCreatedLength=function(t){t>=this._iterationLength-1&&(this._iterationLength-=1)},e.prototype.incrementCreatedLength=function(t){t>=this._iterationLength&&(this._iterationLength+=1)},e.prototype.delete=function(t){var e=this._keys.get(t);return void 0!==e&&(this._values[e].active?this._nbActive-=1:this._nbInactive-=1,this.mapObject(this._values[e],this._zeroedRef),this._values[e].entityId="0",this._keys.delete(t),this.decrementCreatedLength(e),this._nbCreated-=1,!0)},e.prototype.recycle=function(t,e){var n=this,r=JSON.parse(JSON.stringify(e));this._values[t]=Object.create(e),Object.keys(e).forEach(function(e){n._values[t][e]=r[e]})},e.prototype.resize=function(t){var e=t-this.size;if(e>0){var n=this._values.length;this._values.length+=e;for(var r=0;r<e;++r)this.createZeroedComponentAt(n+r)}else if(e<0){e=Math.abs(e);for(var r=0;r<e;++r){var i=this._values[this._values.length-1];this._keys.delete(i.entityId),this._values.pop()}}this._size+=e},Object.defineProperty(e.prototype,"iterationLength",{get:function(){return this._iterationLength},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nbActive",{get:function(){return this._nbActive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nbInactive",{get:function(){return this._nbInactive},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nbCreated",{get:function(){return this._nbCreated},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"nbFreeSlot",{get:function(){return this._size-this._nbActive-this._nbInactive},enumerable:!0,configurable:!0}),e.prototype.insertAfter=function(t,e,n){return!1},e.prototype.insertBefore=function(t,e,n){return!1},e}(i.FastIterationMap);e.ComponentFactory=o;var s=function(){function t(t){this._size=t,this._factories=new Map}return t.prototype.activate=function(t,e,n){var r=this;n?n.forEach(function(n){var i=r.getFactory(n);i&&i.activate(t,e)}):this._factories.forEach(function(n){n.activate(t,e)})},t.prototype.activateAll=function(t){this._factories.forEach(function(e){e.activateAll(t)})},t.prototype.addFactory=function(t,e){e.size!==this._size&&e.resize(this._size),this._factories.set(t,e)},t.prototype.getComponent=function(t,e){var n=this._factories.get(e);return n?n.get(t):void 0},t.prototype.getFactory=function(t){return this._factories.get(t)},t.prototype.delete=function(t){var e=!0;return this._factories.forEach(function(n){n.delete(t)||(e=!1)}),this._factories.size>0&&e},t.prototype.get=function(t){var e=[];return this._factories.forEach(function(n){e.push(n.get(t))}),e},t.prototype.has=function(t){return this._factories.entries().next().value[1].has(t)},t.prototype.create=function(t,e){this._factories.forEach(function(n){n.create(t,e)})},t.prototype.resize=function(t){this._factories.forEach(function(e){e.resize(t)}),this._size=t},Object.defineProperty(t.prototype,"iterationLength",{get:function(){return this._factories.entries().next().value[1].iterationLength},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nbActive",{get:function(){return this._factories.entries().next().value[1].nbActive},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nbCreated",{get:function(){return this._factories.entries().next().value[1].nbCreated},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nbFreeSlot",{get:function(){return this._factories.entries().next().value[1].nbFreeSlot},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"nbInactive",{get:function(){return this._factories.entries().next().value[1].nbInactive},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),t}();e.EntityFactory=s},function(t,e,n){!function(e,n){t.exports=n()}(0,function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,n){t.exports=n(1)},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){this._keys=new Map,this._values=[]}return t.prototype.clear=function(){this._keys.clear(),this._values=[]},t.prototype.delete=function(t){var e=this._keys.get(t),n=this._keys.delete(t);return this.offsetIndexInKeys(e,-1),!!(this._values.splice(e,1).length>0&&n)},t.prototype.get=function(t){return this._values[this._keys.get(t)]},t.prototype.has=function(t){return this._keys.has(t)},t.prototype.insertValue=function(t,e,n){return this._values.splice(n,0,e)},t.prototype.offsetIndexInKeys=function(t,e,n){var r=this._keys.entries(),i=this._keys.size;n=n||Number.MAX_VALUE;for(var o=0;o<i;++o){var s=r.next().value;s[1]>t&&s[1]<n&&this._keys.set(s[0],s[1]+=e)}},t.prototype.insertAfter=function(t,e,n){if(void 0!==this._keys.get(t))return!1;var r=this._keys.get(n);return this.insertValue(t,e,r+1),void 0!==r&&(this.offsetIndexInKeys(r,1),this._keys.set(t,r+1),!0)},t.prototype.insertBefore=function(t,e,n){if(void 0!==this._keys.get(t))return!1;var r=this._keys.get(n);return this.insertValue(t,e,r),void 0!==r&&(this.offsetIndexInKeys(r-1,1),this._keys.set(t,r),!0)},Object.defineProperty(t.prototype,"keys",{get:function(){return this._keys},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"length",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),t.prototype.push=function(t,e){var n=this._keys.get(t);if(void 0===n){var r=this._values.push(e);this._keys.set(t,r-1)}else this._values[n]=e;return this._values.length},t.prototype.set=function(t,e){return this.push(t,e)},Object.defineProperty(t.prototype,"size",{get:function(){return this._values.length},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){return this._values},enumerable:!0,configurable:!0}),t}();e.FastIterationMap=r}])})},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=function(){function t(){}return t.prototype.process=function(t){for(var e=t.iterationLength,n=t.values,r=0;r<e;++r)n[r].active&&this.execute(n[r])},t}();e.System=r;var i=function(){function t(){}return t.prototype.process=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=t.iterationLength,i=t.values,o=0;o<r;++o)if(i[o].active){var s=[];s.push(i[o]);for(var a=0;a<e.length;++a)s.push(e[a].values[o]);this.execute.apply(null,s)}},t}();e.MultiParallelSystem=i;var o=function(){function t(){}return t.prototype.process=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=t.iterationLength,i=t.values,o=0;o<r;++o)if(i[o].active){var s=[];s.push(i[o]);for(var a=!0,u=0;u<e.length;++u){var c=e[u].get(i[o].entityId);if(!c){a=!1;break}s.push(c)}a&&this.execute.apply(null,s)}},t}();e.MultiNonParallelSystem=o}])});